# dutClasstable
曾经的那个为大家提供各种教务服务的大连理工大学微信小程序，于2019年9月末下线，不知道未来有没有机会回来。这个小程序不是我个人首创，我只是作为延续者和传承者，对这个小程序进行了第三代改进。
前段:wxml&wxss&js
后端：php和极少的js，js只为使用模拟登陆加密函数

## 工作原理
   前端就是简单的微信小程序，不过由于小程序最初上线比较早，后面虽然更新了几代，但是写法还是比较旧。
   后端架构稍微麻烦，因为曾经学校教务系统必须学校内网才能直接访问，所以后端使用了两台服务器。一台为阿里云云服务器，另一台为学校内网自搭建服务，使用内网穿透工具（frp）链接两个服务器。内网服务器负责获取数据，公网服务器负责连接微信小程。
   第一代通过模拟登陆学校教务官网获取教务数据，第二代学校统一校园门户后通过模拟登陆校园门户利用校园门户cookie跳转教务官网，第三代学校摒弃旧版教务系统，推出新版教务综合系统后，采用模拟登陆校园门户之后使用cookie跳转新版教务综合系统，然后获取用户代码，请求数据接口截获对应数据包。因为刚刚开发完获取课表数据之后小程序即下线，所以只完成了抓取课表。笔者已经研究过抓取成绩，考试时间等数据完全类似。

## 目录结构
### 前段代码
   就是简简单单的微信小程序源码，没有太多花里胡哨的。不过其中数据处理格式和设置的一些缓存想要理解要花费一些时间，尤其是那个数据处理格式，第一代开发者的建立的结构真的玄学，但是却异常好用。找不到之前的图了，分析数据结构去看后端封装数据的代码吧

### 后端公网云服务器
  主要负责接受内网服务器传来的获取到的各种数据，这些数据中基本上都还包含html标签，所以此时在云服务器上进行结构化数据获取并建立数据结构，然后返回给前端。

### 后端内网服务器
  负责模拟登录校园门户，这个要是自己探索你会发现非常的恶心，建议去官网去抓包看看就明白了了，不要以为构建好身份认证字符串就好了，还有6次重定向，要一直跟着跳，然后跳转新版教务综合管理系统，还有6次重定向，吐了。
  
# 注意 
其实在新版教务综合管理系统出来以后，学校教务资源均可以通过公网访问了，内网服务器不再需要，但是还没来得及转移我们就给下线了，所以后端代码可以放到一起了，节省点带宽资源，云服务器带宽挺贵的。


